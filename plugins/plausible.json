{
  "$schema": "https://raw.githubusercontent.com/invoiceradar/plugins/main/schema.json",
  "id": "plausible",
  "name": "Plausible",
  "description": "Plausible provides more privacy-friendly web analytics.",
  "homepage": "https://plausible.io/",
  "configSchema": {},
  "checkAuth": [
    {
      "action": "navigate",
      "url": "https://plausible.io/settings"
    },
    {
      "action": "checkURL",
      "url": "/settings"
    }
  ],
  "startAuth": [
    {
      "action": "navigate",
      "url": "https://plausible.io/login"
    },
    {
      "action": "waitForURL",
      "url": "/sites",
      "timeout": 120000
    }
  ],
  "getDocuments": [
    {
      "action": "navigate",
      "url": "https://plausible.io/settings/billing/invoices"
    },
    {
      "action": "extractAll",
      "script": "Array.from(document.querySelectorAll('table tbody tr'))\n  .map((row) => {\n    const cells = row.querySelectorAll('td')\n    const date = cells[0].innerText.trim()\n    const total = cells[1].innerText.trim()\n    const link = cells[2].querySelector('a')\n    if (!link) {\n      return null\n    }\n    const url = link.href\n    const match = url.match(/receipt\\/([^\\/]+)/)\n    if (!match || !match[1]) {\n      return null\n    }\n    return { id: match[1], date, total, url }\n  })\n  .filter((row) => row !== null)",
      "variable": "item",
      "forEach": [
        {
          "action": "sleep",
          "duration": 2000,
          "description": "Prevent rate limiting"
        },
        {
          "action": "navigate",
          "url": "{{item.url}}"
        },
        {
          "action": "printPdf",
          "document": "{{item}}"
        }
      ]
    }
  ]
}
